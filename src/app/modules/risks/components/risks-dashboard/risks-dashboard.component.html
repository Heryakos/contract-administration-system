<div class="dashboard-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading dashboard data...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-container">
    <mat-icon color="warn">error</mat-icon>
    <p>{{ error }}</p>
    <button mat-raised-button color="primary" (click)="refresh()">
      <mat-icon>refresh</mat-icon>
      Retry
    </button>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading && !error" class="dashboard-content">
    <div class="dashboard-header">
      <h1>Risk & Compliance Dashboard</h1>
      <button mat-icon-button (click)="refresh()" matTooltip="Refresh Data">
        <mat-icon>refresh</mat-icon>
      </button>
    </div>

    <mat-tab-group>
      <!-- Risk Management Tab -->
      <mat-tab label="Risk Management">
        <div class="tab-content">
          <!-- Risk Summary Cards -->
          <div class="summary-cards" *ngIf="riskDashboard as rdb">
            <mat-card class="summary-card">
              <mat-card-content>
                <div class="card-header">
                  <mat-icon color="primary">assessment</mat-icon>
                  <span class="card-title">Total Risks</span>
                </div>
                <div class="card-value">{{ rdb.totalRisks }}</div>
              </mat-card-content>
            </mat-card>

            <mat-card class="summary-card critical">
              <mat-card-content>
                <div class="card-header">
                  <mat-icon color="warn">warning</mat-icon>
                  <span class="card-title">Critical Risks</span>
                </div>
                <div class="card-value">{{ rdb.criticalRisks }}</div>
              </mat-card-content>
            </mat-card>

            <mat-card class="summary-card high">
              <mat-card-content>
                <div class="card-header">
                  <mat-icon color="accent">priority_high</mat-icon>
                  <span class="card-title">High Risks</span>
                </div>
                <div class="card-value">{{ rdb.highRisks }}</div>
              </mat-card-content>
            </mat-card>

            <mat-card class="summary-card">
              <mat-card-content>
                <div class="card-header">
                  <mat-icon>lock_open</mat-icon>
                  <span class="card-title">Open Risks</span>
                </div>
                <div class="card-value">{{ rdb.openRisks }}</div>
              </mat-card-content>
            </mat-card>
          </div>

          <!-- Risk Categories Chart -->
          <mat-card class="chart-card" *ngIf="riskDashboard">
            <mat-card-header>
              <mat-card-title>Risks by Category</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="category-list">
                <div *ngFor="let entry of getRiskCategoryEntries()" class="category-item">
                  <span class="category-name">{{ entry[0] }}</span>
                  <span class="category-count">{{ entry[1] }}</span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Quick Actions -->
          <div class="quick-actions">
            <button mat-raised-button color="primary" routerLink="/risks/risks">
              <mat-icon>list</mat-icon>
              View All Risks
            </button>
          </div>
        </div>
      </mat-tab>

      <!-- Compliance Management Tab -->
      <mat-tab label="Compliance Management">
        <div class="tab-content">
          <!-- Compliance Summary Cards -->
          <div class="summary-cards" *ngIf="complianceDashboard as cdb">
            <mat-card class="summary-card">
              <mat-card-content>
                <div class="card-header">
                  <mat-icon color="primary">rule</mat-icon>
                  <span class="card-title">Total Requirements</span>
                </div>
                <div class="card-value">{{ cdb.totalRequirements }}</div>
              </mat-card-content>
            </mat-card>

            <mat-card class="summary-card completed">
              <mat-card-content>
                <div class="card-header">
                  <mat-icon color="primary">check_circle</mat-icon>
                  <span class="card-title">Completed</span>
                </div>
                <div class="card-value">{{ cdb.completedRequirements }}</div>
              </mat-card-content>
            </mat-card>

            <mat-card class="summary-card overdue">
              <mat-card-content>
                <div class="card-header">
                  <mat-icon color="warn">schedule</mat-icon>
                  <span class="card-title">Overdue</span>
                </div>
                <div class="card-value">{{ cdb.overdueRequirements }}</div>
              </mat-card-content>
            </mat-card>

            <mat-card class="summary-card">
              <mat-card-content>
                <div class="card-header">
                  <mat-icon>trending_up</mat-icon>
                  <span class="card-title">Compliance Rate</span>
                </div>
                <div class="card-value">{{ cdb.complianceRate | number:'1.1-1' }}%</div>
              </mat-card-content>
            </mat-card>
          </div>

          <!-- Compliance Types Chart -->
          <mat-card class="chart-card" *ngIf="complianceDashboard">
            <mat-card-header>
              <mat-card-title>Requirements by Type</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="category-list">
                <div *ngFor="let entry of getComplianceTypeEntries()" class="category-item">
                  <span class="category-name">{{ entry[0] }}</span>
                  <span class="category-count">{{ entry[1] }}</span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Quick Actions -->
          <div class="quick-actions">
            <button mat-raised-button color="primary" routerLink="/risks">
              <mat-icon>list</mat-icon>
              View Requirements
            </button>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>
