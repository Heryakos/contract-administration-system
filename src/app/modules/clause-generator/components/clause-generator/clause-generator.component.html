<div class="clause-generator">
  <!-- Header -->
  <mat-toolbar class="header-toolbar">
    <div class="toolbar-content">
      <div class="title-section">
        <h1 class="main-title">Clause Generator</h1>
        <p class="subtitle">Create and manage contract clauses</p>
      </div>
      <div class="actions-section">
        <button mat-stroked-button 
                (click)="saveDraft()" 
                [disabled]="isCreating || clauseForm.invalid" 
                class="action-btn">
          <mat-icon>save</mat-icon>
          {{ isCreating ? 'Saving...' : 'Save Draft' }}
        </button>
        <button mat-stroked-button 
                (click)="exportToPDF()" 
                [disabled]="!clauseForm.get('clauseContent')?.value"
                class="action-btn">
          <mat-icon>picture_as_pdf</mat-icon>
          Export PDF
        </button>
        <button mat-stroked-button 
                (click)="print()" 
                [disabled]="!clauseForm.get('clauseContent')?.value"
                class="action-btn">
          <mat-icon>print</mat-icon>
          Print
        </button>
        <button mat-raised-button 
                (click)="submitForApproval()" 
                [disabled]="isCreating || isSubmitting || clauseForm.invalid" 
                color="primary" 
                class="action-btn">
          <mat-spinner *ngIf="isSubmitting" diameter="20"></mat-spinner>
          <mat-icon *ngIf="!isSubmitting">send</mat-icon>
          {{ isSubmitting ? 'Submitting...' : 'Submit for Approval' }}
        </button>
        <button mat-stroked-button (click)="togglePreview()" class="action-btn">
          <mat-icon>{{ showPreview ? 'visibility_off' : 'visibility' }}</mat-icon>
          {{ showPreview ? 'Hide' : 'Show' }} Preview
        </button>
      </div>
    </div>
  </mat-toolbar>

  <div class="main-container">
    <div class="content-grid" [ngClass]="{'with-preview': showPreview, 'full-width': !showPreview}">
      
      <!-- Form Panel -->
      <div class="form-panel">
        <mat-card class="clause-form-card">
          <mat-card-header>
            <mat-card-title class="card-title">
              <mat-icon>edit</mat-icon>
              Clause Details
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <form [formGroup]="clauseForm" class="clause-form" novalidate>
              
              <!-- Clause Title -->
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Clause Title *</mat-label>
                <input matInput 
                       formControlName="clauseTitle" 
                       placeholder="Enter clause title..."
                       maxlength="300">
                <mat-hint>Maximum 300 characters</mat-hint>
                <mat-error *ngIf="clauseForm.get('clauseTitle')?.touched && clauseForm.get('clauseTitle')?.invalid">
                  {{ getErrorMessage('clauseTitle') }}
                </mat-error>
              </mat-form-field>

              <!-- Category -->
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Category *</mat-label>
                <mat-select formControlName="clauseCategory">
                  <mat-option *ngFor="let category of categories" [value]="category">
                    {{ category }}
                  </mat-option>
                </mat-select>
                <mat-error *ngIf="clauseForm.get('clauseCategory')?.touched && clauseForm.get('clauseCategory')?.invalid">
                  {{ getErrorMessage('clauseCategory') }}
                </mat-error>
              </mat-form-field>

              <!-- Tags Section -->
              <div class="tags-section">
                <h3>Tags</h3>
                <p class="section-help">Select relevant tags or add custom ones below</p>
                <div class="tag-selection">
                  <div class="tag-chips">
                    <mat-chip-listbox class="tag-list" aria-label="Tag selection">
                      <mat-chip-option 
                        *ngFor="let tag of availableTags"
                        [selected]="isTagSelected(tag)"
                        (click)="onTagSelectionChange(tag)"
                        class="tag-option">
                        {{ tag }}
                      </mat-chip-option>
                    </mat-chip-listbox>
                  </div>
                  
                  <!-- Custom Tag Input -->
                  <mat-form-field appearance="outline" class="full-width custom-tag-field">
                    <mat-label>Add Custom Tag</mat-label>
                    <input matInput 
                           #customTagInput
                           (keydown.enter)="addCustomTag($event)"
                           placeholder="Type new tag and press Enter"
                           maxlength="50">
                    <mat-hint>Press Enter to add</mat-hint>
                  </mat-form-field>

                  <!-- Selected Tags -->
                  <div class="selected-tags" *ngIf="selectedTags.length > 0">
                    <h4>Selected Tags ({{ selectedTags.length }})</h4>
                    <div class="selected-tag-chips">
                      <mat-chip 
                        *ngFor="let tag of selectedTags; let i = index" 
                        [removable]="true" 
                        (removed)="removeTag(tag)"
                        class="selected-tag">
                        {{ tag }}
                        <mat-icon matChipRemove>cancel</mat-icon>
                      </mat-chip>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Clause Content -->
              <div class="content-section">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Clause Content *</mat-label>
                  <textarea 
                    matInput 
                    formControlName="clauseContent"
                    rows="15"
                    placeholder="Enter your clause content here. Use standard legal formatting and include all necessary terms, conditions, and provisions..."
                    cdkTextareaAutosize
                    cdkAutosizeMinRows="5"
                    cdkAutosizeMaxRows="20"></textarea>
                  <mat-hint>Describe the clause in detail</mat-hint>
                  <mat-error *ngIf="clauseForm.get('clauseContent')?.touched && clauseForm.get('clauseContent')?.invalid">
                    {{ getErrorMessage('clauseContent') }}
                  </mat-error>
                </mat-form-field>
              </div>

            </form>
          </mat-card-content>
          <mat-card-actions class="form-actions">
            <button mat-stroked-button (click)="resetForm()" type="button" class="reset-btn">
              <mat-icon>refresh</mat-icon>
              Reset Form
            </button>
            <span class="form-status" *ngIf="clauseForm.invalid && clauseForm.touched">
              <mat-icon color="warn">error</mat-icon>
              Please fix the errors above
            </span>
          </mat-card-actions>
        </mat-card>
      </div>

      <!-- Preview Panel -->
      <div class="preview-panel" *ngIf="showPreview">
        <mat-card class="preview-card">
          <mat-card-header>
            <mat-card-title class="card-title">
              <mat-icon>preview</mat-icon>
              Live Preview
            </mat-card-title>
            <mat-card-subtitle>Real-time preview of your clause</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content class="preview-content-wrapper">
            <div class="preview-content" [class.loading]="!previewContent">
              <div class="preview-header">
                <h2 class="clause-title">{{ clauseForm.get('clauseTitle')?.value || 'Untitled Clause' }}</h2>
                <div class="preview-meta">
                  <mat-chip *ngIf="clauseForm.get('clauseCategory')?.value" color="primary" selected>
                    {{ clauseForm.get('clauseCategory')?.value }}
                  </mat-chip>
                  <span class="tag-count" *ngIf="selectedTags.length > 0">
                    {{ selectedTags.length }} tag{{ selectedTags.length !== 1 ? 's' : '' }}
                  </span>
                </div>
              </div>
              
              <div class="preview-tags" *ngIf="selectedTags.length > 0">
                <mat-chip *ngFor="let tag of selectedTags" class="tag-chip" size="small">
                  {{ tag }}
                </mat-chip>
              </div>
              
              <div class="clause-content-preview">
                <div *ngIf="!previewContent" class="empty-state">
                  <mat-icon>edit</mat-icon>
                  <p>Start typing your clause content above to see the preview here</p>
                </div>
                <div *ngIf="previewContent" class="content-preview">
                  <pre class="clause-text">{{ previewContent }}</pre>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

    </div>
  </div>
</div>